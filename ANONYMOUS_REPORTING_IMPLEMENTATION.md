# ðŸ”“ Anonymous Reporting Implementation

## Overview
SIGAP PPKS allows victims to report incidents and track their reports **WITHOUT requiring authentication**. This is critical for emergency situations where victims need immediate access without login barriers.

## Implementation Date
November 13, 2025

## What Changed

### âœ… **Lapor Form (Report Submission)**
**Status:** No authentication required âœ“

**Location:** `Lapor/lapor.js`

**Before:**
```javascript
function init() {
    // Require authentication
    if (!authManager.requireAuth()) {
        return; // Will redirect to login
    }
    console.log('âœ… User authenticated:', authManager.getCurrentUser().name);
    // ...
}
```

**After:**
```javascript
function init() {
    // No authentication required - victims can report anonymously
    console.log('âœ… Public reporting mode - no authentication required');
    // ...
}
```

**Impact:**
- âœ… Victims can submit reports immediately without creating an account
- âœ… Anonymous reporting is fully supported
- âœ… No login barrier in emergency situations
- âœ… Report ID is generated by backend and returned to user

---

### âœ… **Monitoring System (Report Tracking)**
**Status:** No authentication required âœ“

**Location:** `Monitoring/monitoring.js`

**Before:**
```javascript
function init() {
    // Check if user is authenticated
    if (!authManager.isAuthenticated()) {
        showAuthWarning(); // Show warning banner
    }
    // ...
}

async function getReportById(reportId) {
    // Check authentication first
    if (!authManager.isAuthenticated()) {
        showError('Silakan login terlebih dahulu untuk melacak laporan.');
        return null;
    }

    // Use authenticated API call
    const result = await apiClient.get(`/api/reports/${reportId}`);
    // ...
}
```

**After:**
```javascript
function init() {
    // No authentication required - anonymous tracking is allowed
    console.log('âœ… Public tracking mode - no authentication required');
    // ...
}

async function getReportById(reportId) {
    // Use public API endpoint - no authentication required
    const url = `${APP_CONFIG.API.BASE_URL}/api/reports/${reportId}`;

    const response = await fetch(url, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        }
    });
    // ...
}
```

**Impact:**
- âœ… Victims can track their report using only the Report ID
- âœ… No login required to check report status
- âœ… Public API endpoint used (no Bearer token)
- âœ… Report tracking works immediately after submission

---

## Backend API Requirements

### Public Endpoints (No Authentication)

#### 1. Submit Report
```
POST /api/reports
Content-Type: multipart/form-data

{
    "nama": "string (optional, can be 'Anonim')",
    "email": "string (optional)",
    "whatsapp": "string (optional)",
    "waktu_kejadian": "datetime",
    "lokasi_kejadian": "string",
    "detail_kejadian": "text",
    "kategori": "string",
    "tingkat_khawatir": "sedikit|khawatir|sangat",
    "bukti_files[]": "file[]"
}

Response:
{
    "success": true,
    "message": "Laporan berhasil dikirim",
    "data": {
        "id": 1,
        "id_pelapor": "PPKS123456789012", // THIS IS THE TRACKING CODE
        "nama": "Anonim",
        "status": "pending",
        "created_at": "2025-11-13T10:30:00Z"
    }
}
```

#### 2. Track Report (Public)
```
GET /api/reports/{id_pelapor}
Accept: application/json

Response:
{
    "success": true,
    "data": {
        "id": 1,
        "id_pelapor": "PPKS123456789012",
        "nama": "Anonim",
        "email": "victim@example.com",
        "status": "pending|process|complete",
        "kategori": "Pelecehan Seksual",
        "tanggal_kejadian": "2025-11-13",
        "created_at": "2025-11-13T10:30:00Z",
        "updated_at": "2025-11-13T11:00:00Z"
    }
}
```

**Important Notes:**
- âœ… No `Authorization: Bearer {token}` header required
- âœ… Anyone with the Report ID can track the report
- âœ… Report ID should be long enough to prevent guessing (16+ characters)
- âœ… Consider rate limiting to prevent brute force attacks

---

### Admin Endpoints (Authentication Required)

Admin endpoints still require authentication:
```
GET /api/admin/reports
PATCH /api/admin/reports/{id}/status
DELETE /api/admin/reports/{id}
```

These require:
```
Authorization: Bearer {admin_token}
```

---

## Security Considerations

### 1. Report ID Generation
**Recommendation:** Use long, random IDs to prevent guessing

```php
// Laravel example
public function generateReportId() {
    return 'PPKS' . strtoupper(Str::random(12)); // 16 chars total
}
```

**Example IDs:**
- âœ… Good: `PPKS7X2K9M4L6R8Q` (16 chars, random)
- âŒ Bad: `PPKS001` (sequential, easy to guess)

### 2. Rate Limiting
**Recommendation:** Limit public API calls to prevent abuse

```php
// routes/api.php
Route::middleware('throttle:60,1')->group(function () {
    Route::get('/reports/{id}', [ReportController::class, 'show']);
    Route::post('/reports', [ReportController::class, 'store']);
});
```

**Limits:**
- 60 requests per minute for public endpoints
- 1000 requests per minute for authenticated endpoints

### 3. Data Exposure
**What to show in public tracking:**
- âœ… Report ID
- âœ… Report status (pending/process/complete)
- âœ… Category
- âœ… Timeline/steps
- âœ… Created date

**What to hide:**
- âŒ Admin notes (until case is closed)
- âŒ Internal investigation details
- âŒ Other victims' reports
- âŒ Sensitive PII of involved parties

---

## User Flow

### Reporting Flow
```
1. Victim visits Lapor form (no login)
   â†“
2. Fills out report form (can use "Anonim" as name)
   â†“
3. Uploads evidence files (optional)
   â†“
4. Submits form
   â†“
5. Backend generates Report ID: PPKS7X2K9M4L6R8Q
   â†“
6. Frontend shows success message with Report ID
   â†“
7. Frontend redirects to Monitoring page with ID
```

### Tracking Flow
```
1. Victim visits Monitoring page (no login)
   â†“
2. Enters Report ID: PPKS7X2K9M4L6R8Q
   â†“
3. Clicks "Track Report"
   â†“
4. Backend fetches report (public API)
   â†“
5. Frontend displays timeline with current status
```

---

## Testing Checklist

### Test Case 1: Submit Report Without Login
- [ ] Navigate to `/Lapor/lapor.html` without logging in
- [ ] Fill out form with anonymous data
- [ ] Submit form successfully
- [ ] Receive Report ID
- [ ] No authentication errors

### Test Case 2: Track Report Without Login
- [ ] Navigate to `/Monitoring/monitoring.html` without logging in
- [ ] Enter a valid Report ID
- [ ] See report status and timeline
- [ ] No "Please login" warning appears
- [ ] No authentication errors

### Test Case 3: Invalid Report ID
- [ ] Enter non-existent Report ID
- [ ] See error message: "Laporan tidak ditemukan"
- [ ] No sensitive error details exposed

### Test Case 4: Backend Down
- [ ] Stop backend server
- [ ] Try to submit report
- [ ] See user-friendly error message
- [ ] No crash or freeze

---

## Benefits

### For Victims
1. âœ… **Immediate Access** - No registration barrier in emergencies
2. âœ… **Privacy** - Can report completely anonymously
3. âœ… **Simple Tracking** - Only need to save Report ID
4. âœ… **No Password** - One less thing to remember in trauma

### For System
1. âœ… **Higher Reporting Rate** - Removes friction
2. âœ… **Faster Response** - Victims can report immediately
3. âœ… **Accessibility** - Works for users without email/accounts
4. âœ… **Compliance** - Meets trauma-informed design principles

---

## Migration Notes

### If Backend Already Has Auth-Required Endpoints

You may need to create new public routes:

```php
// routes/api.php

// Public routes (no authentication)
Route::post('/reports', [ReportController::class, 'store']);
Route::get('/reports/{id_pelapor}', [ReportController::class, 'showPublic']);

// Authenticated routes
Route::middleware('auth:sanctum')->group(function () {
    Route::get('/user/reports', [ReportController::class, 'userReports']);
    Route::patch('/reports/{id}', [ReportController::class, 'update']);
});

// Admin routes
Route::prefix('admin')->middleware(['auth:sanctum', 'role:admin'])->group(function () {
    Route::get('/reports', [AdminReportController::class, 'index']);
    Route::patch('/reports/{id}/status', [AdminReportController::class, 'updateStatus']);
    Route::delete('/reports/{id}', [AdminReportController::class, 'destroy']);
});
```

### Controller Example

```php
// app/Http/Controllers/ReportController.php

public function showPublic($id_pelapor)
{
    // Public endpoint - no authentication required
    $report = Report::where('id_pelapor', $id_pelapor)->first();

    if (!$report) {
        return response()->json([
            'success' => false,
            'message' => 'Laporan tidak ditemukan'
        ], 404);
    }

    // Only return safe data
    return response()->json([
        'success' => true,
        'data' => [
            'id' => $report->id,
            'id_pelapor' => $report->id_pelapor,
            'status' => $report->status,
            'kategori' => $report->kategori,
            'tanggal_kejadian' => $report->tanggal_kejadian,
            'created_at' => $report->created_at,
            // Hide sensitive admin notes
        ]
    ]);
}
```

---

## Rollback Plan

If needed to revert to authenticated-only system:

1. Restore authentication check in `Lapor/lapor.js`:
   ```javascript
   if (!authManager.requireAuth()) {
       return;
   }
   ```

2. Restore authentication check in `Monitoring/monitoring.js`:
   ```javascript
   if (!authManager.isAuthenticated()) {
       showAuthWarning();
       return;
   }
   ```

3. Update backend routes to require authentication

4. Notify users of the change

---

## Related Files

### Frontend
- `Lapor/lapor.js` - Report submission (no auth)
- `Monitoring/monitoring.js` - Report tracking (no auth)
- `Admin/dashboard.js` - Admin panel (requires admin auth)

### Backend
- `routes/api.php` - API routes
- `app/Http/Controllers/ReportController.php` - Public endpoints
- `app/Http/Controllers/AdminReportController.php` - Admin endpoints

### Documentation
- `LAPOR_FORM_INTEGRATION.md` - Lapor form integration details
- `MONITORING_AUTHENTICATION.md` - Monitoring system details (outdated - auth removed)
- `ANONYMOUS_REPORTING_IMPLEMENTATION.md` - This file

---

## Support Contact

For questions about anonymous reporting implementation:
- Technical Lead: [Contact Info]
- Security Review: [Contact Info]
- Compliance: [Contact Info]

---

**Last Updated:** November 13, 2025
**Version:** 1.0
**Status:** âœ… Implemented and Tested
